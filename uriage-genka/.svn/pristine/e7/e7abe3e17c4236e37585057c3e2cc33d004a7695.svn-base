package ug.action;

import java.util.ArrayList;
import java.util.List;

import javax.annotation.Resource;

import org.seasar.extension.jdbc.JdbcManager;
import org.seasar.struts.annotation.ActionForm;
import org.seasar.struts.annotation.Execute;

import ug.dto.UserDataDto;
import ug.entity.GenkaKanri;
import ug.entity.MonthlyGenka;
import ug.form.GkListForm;
import ug.service.GenkaKanriService;
import ug.util.StringUtil;

public class GkListAction {

	@Resource
	@ActionForm
	protected GkListForm gkListForm;

	@Resource
	public UserDataDto userDataDto;

	@Resource
	protected GenkaKanriService genkaKanriService;

	@Resource
	protected JdbcManager jdbcManager;

	public List<GenkaKanri> gkList;

	public List<MonthlyGenka> nendoList;

	@Execute(validator = false)
	public String index(){

		//TODO 検証用にIDを権限を付与
		userDataDto.gkInsert = "1";

		gkList=new ArrayList<GenkaKanri>();

		/*
		 * monthly_genkaテーブルをnendoでgroupbyした年度データを取得する。
		 * 残念ながらsimpleWhereはgroupby句には対応していないらしい。
		 */
		//TODO 年度リストにとりあえずの値を挿入
		//nendoList = jdbcManager.selectBySql(MonthlyGenka.class, "select nendo from monthly_genka order by nendo").getResultList();
		nendoList=new ArrayList<MonthlyGenka>();
		for(int i=2016; i<2019; i++){
			MonthlyGenka mg = new MonthlyGenka();
			mg.nendo = i;
			nendoList.add(mg);
		}

		gkListForm.nendo = StringUtil.getCurrentNendo();

		gkList = genkaKanriService.getGkList(gkListForm.nendo);

		return "gkList.jsp";
	}

}
